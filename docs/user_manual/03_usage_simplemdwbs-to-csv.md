# 3. SimpleMdWbsからCSVへの変換 (`Convert-SimpleMdWbsToCsv.ps1`)

このスクリプトは、`simple-md-wbs` 記法で記述されたMarkdownファイルを解析し、WBS情報をCSVファイルとして出力します。

## 3.1. 実行方法

PowerShellコンソールで以下のコマンドを実行します。

```powershell
.\Convert-SimpleMdWbsToCsv.ps1 -InputFilePath "パス\to\your\wbs.md" -OutputCsvPath "パス\to\your\output.csv"
```

**`パラメータ`:**

* `-InputFilePath <文字列>`（必須）
  * 入力する `simple-md-wbs` ファイルのパスを指定します。
  * デフォルト値: `.\simple-md-wbs-sample.md`
* `-OutputCsvPath <文字列>`（必須）
  * 出力するCSVファイルのパスを指定します。
  * デフォルト値: `.\wbs_output_prototype.csv`（プロトタイプ時の名称。正式版では変更推奨）

## 3.2. 出力されるCSVファイルの形式

出力されるCSVファイルはUTF-8エンコーディング（BOMなし）で、以下の列構成を持ちます。
（※ 列名や順序は、最終的なExcelテンプレート `wbs-gantt-template.xlsx` との整合性を考慮して調整される可能性があります。）

| 列ヘッダー（日本語例）        | 内容                                                          | 出典（`simple-md-wbs`の要素）|
|-------------------------------|---------------------------------------------------------------|------------------------|
| タスクID                      | ツールが自動生成する階層的なソート用ID（例: `01.01.01.01`）   | ツール自動生成         |
| 大分類                        | 大分類（H2）の名称（該当アイテムのみ）                        | H2見出しテキスト       |
| 中分類                        | 中分類（H3）の名称（該当アイテムのみ）                        | H3見出しテキスト       |
| 小分類                        | 小分類（H4）の名称（該当アイテムのみ）                        | H4見出しテキスト       |
| タスク名称 | プロジェクト名（H1）またはタスク（リストアイテム）の名称（該当アイテムのみ）| H1見出しテキスト / リストアイテムテキスト |
| 先行有無                      |（Excel計算用。ツールからは直接出力しないか、依存関係から判定）|（ツールでは未実装）    |
| 関連番号（先行タスクID）      | 解決済みの先行タスクの「タスクID」（上記ソート用ID） | 依存関係解決ロジック（先行タスクユーザー記述IDから検索）|
| 先行後続タスク名              | 解決済みの先行タスクの「タスク名称」または「カテゴリ名」      | 依存関係解決ロジック   |
| 担当組織                      |                                                               | 「担当組織」属性       |
| 担当者                        |                                                               | 「担当者」属性         |
| 終了入力（終了日）            | YYYY-MM-DD形式                                                | 「終了日」属性         |
| 日数入力（日数）              | 整数                                                          | 「日数」属性           |
| 進捗率                        | 文字列（例: `50%`, `0.5`）                                    | 「進捗率」属性         |
| 開始日実績                    | YYYY-MM-DD形式                                                | 「開始日実績」属性     |
| ユーザー記述ID（元ID）        | WBS記法内でユーザーが定義したID                               | 「ユーザー記述ID」属性 |
| 依存関係種別                  | "先行" または "後続"                                          | 「依存関係種別」属性   |
| 先行タスクユーザー記述ID（元）| WBS記法内でユーザーが定義した先行タスクID                     | 「先行タスクID」属性   |
| コメント                      |                                                               | 「コメント」属性       |
| アイテム種別（デバッグ用）    | `Project`, `Category1`, `Category2`, `Category3`, `Task`      | ツール内部判定         |

## 3.3. 注意事項

* 入力ファイルが存在しない場合や、出力ファイルに書き込めない場合はエラーが発生します。
* `simple-md-wbs` の記述に構文エラーが多い場合、一部の属性が正しく読み取れず空欄になることがあります。その際は `Write-Verbose` オプション付きで実行すると、より詳細な処理状況が確認できます（将来的に実装）。
