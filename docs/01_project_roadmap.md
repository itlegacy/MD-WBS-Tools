# MD-WBS-Tools 開発ロードマップ（段階的構築案）

## 全体方針

* **WBSタスク記法を軸に**: 多くの変換パスで「WBSタスク記法」を中間形式または主要な編集形式として活用し、各ツールの結合をシンプルにする。
* **Markdown互換性**: WBSタスク記法はMarkdownのリスト形式を基本とし、VS CodeのMarkdown機能拡張と親和性を持たせる。
* **フロントマターの柔軟な扱い**: 初期は無視し、徐々に活用。必須ではなくオプションとして扱うことで、シンプルなファイルもサポート。
* **スモールステップ**: 各フェーズで動作する価値を提供し、着実に機能を拡張。
* **堅牢性**: 共通モジュールの品質を高め、テストを重視する。

---

## 開発フェーズ

### フェーズ 0: 基盤整備と最重要パス（WBSタスク記法 ⇔ Excel）

**（期間: 約3-4週間）:**

* **目的**:
  * もっとも基本的な入出力である「WBSタスク記法 ⇔ Excel」の双方向変換を確実に動作させ、堅牢なコアモジュールを構築する。
  * VS CodeでのWBSタスク記法の編集体験を意識した仕様を固める。
* **主要タスク**:
    1. **WBSタスク記法 仕様最終化**:
        * ファイル形式: `.md` を推奨。
        * 基本構造: Markdownの無順序リスト（`-` または `*`）を基本とし、インデントで階層を表現。
        * データ要素: 各リストアイテムのテキスト部分をカンマ区切りで「`名称,終了入力,日数入力,依存種別,依存先行タスク指定,状態,進捗率,担当者,担当組織,固定開始日,最終更新日`」とする。省略ルールは前回定義通り。**行末に `#` で始まるコメントを許容する。**
        * **フロントマター**: オプションとしてファイルの先頭にYAMLフロントマターを許容。**このフェーズではスクリプトはフロントマターを読み飛ばす（解釈しない）**。これにより、フロントマターがないシンプルなWBSタスク記法ファイルも完全に有効とする。
        * `docs/12_wbs_task_syntax_specification.md` に上記仕様を明記 (旧 `docs/02_wbs_task_syntax_specification.yaml` はリッチMD-WBS用として別途 `docs/11_mdwbs_original_syntax.yaml` などに役割を明確化)。
    2. **Excelテンプレート定義**: `samples/excel_templates/wbs-gantt-template.xlsx` の列定義を確定。
    3. **共通モジュール `MyCommonFunctions` 開発（コア機能）**:
        * WBSタスク記法パーサー（Markdownリストアイテム解釈、カンマ区切りデータ抽出、フロントマターのスキップ、**行末コメントの処理: 各リストアイテム行を読み込む際、行末に ` # ` が存在する場合は、それ以降をコメントとして扱い、カンマ区切りデータの解析対象から除外する**）。
        * **依存関係解決ロジック**: 第5要素「依存先行タスク指定」がタスクIDなのかタスク名称なのかを判別し、名称の場合はIDへ解決する処理。
        * データ構造化（階層構造構築、タスクID付与）。
        * 日付計算ロジック（祝日考慮、開始/終了日計算）。
        * Excelデータマッパー（WBSタスク記法データとExcel列間の相互マッピング）。
    4. **スクリプト1: `ConvertTo-ExcelFromWbsTaskNotation.ps1`（WBSタスク記法 → Excel）**
        * COMオブジェクトを利用したExcel直接書き込み。CSV検証ステップは内部的に推奨。
    5. **スクリプト2: `ConvertTo-WbsTaskNotationFromExcel.ps1`（Excel → WBSタスク記法）**
        * 出力するWBSタスク記法ファイルにはフロントマターを付与しない。
    6. **テスト**: 基本的な入出力パターンの手動テストケース作成と実施。フロントマターあり/なし、行末コメントあり/なし両方のWBSタスク記法サンプル（`samples/mdwbs_examples/`）を作成。
    7. **ドキュメント**: `docs/user_manual/` の基本セットアップ、上記2スクリプトの使用法。
* **成果物（このフェーズで確実に手にしたいもの）**:
  * 安定動作する `ConvertTo-ExcelFromWbsTaskNotation.ps1` と `ConvertTo-WbsTaskNotationFromExcel.ps1`。
  * 堅牢な `MyCommonFunctions` モジュール（コア機能）。
  * 明確なWBSタスク記法仕様書とExcelテンプレート。
  * 基本的なユーザーマニュアルとサンプルファイル群。

---

### フェーズ 1: 視覚化と簡易分析パス（Markwhen & Excel→MD-WBSリッチ）

**（期間: 約2-3週間）:**

* **目的**:
  * WBSタスク記法をMarkwhenで視覚化する機能を追加する。
  * ExcelからMarkmapやAI分析用のMD-WBS（リッチ形式）を出力する機能を追加する。
  * フロントマターの基本的な活用を開始（読み取りのみ）。
* **主要タスク**:
    1. **スクリプト3: `ConvertTo-MarkwhenFromWbsTaskNotation.ps1`（WBSタスク記法 → Markwhen）**
        * **フロントマター活用**: WBSタスク記法ファイルにフロントマターがあれば、プロジェクト名や基準日などの定義済みキーを読み取り、Markwhen出力に反映させる（例: Markwhenのタイトル、ビュー設定など）。なければデフォルト値を使用。
    2. **スクリプト4: `ConvertTo-RichMdWbsFromExcel.ps1`（Excel → MD-WBSリッチ）**
        * 出力するMD-WBSには、Excelから読み取れる範囲でプロジェクトメタデータ（シート名などから推定）をフロントマターとして付与する。
        * MD-WBSの各タスクの属性をリッチに記述。
    3. **共通モジュール `MyCommonFunctions` 拡張**:
        * フロントマター解析機能（読み取り。PowerShell 7.3+なら `ConvertFrom-Yaml`、それ以外は正規表現や `-split "---"` で簡易対応）。
        * Markwhen出力整形ロジック。
        * MD-WBS（リッチ形式）出力整形ロジック。
    4. **テスト**: Markwhen出力、MD-WBS（リッチ形式）出力の検証。
    5. **ドキュメント**: スクリプト3, 4の使用法、WBSタスク記法のフロントマターで認識するキーについて追記。
* **成果物**:
  * 動作する `ConvertTo-MarkwhenFromWbsTaskNotation.ps1` と `ConvertTo-RichMdWbsFromExcel.ps1`。
  * フロントマターの読み取り処理を含む `MyCommonFunctions`。
  * 更新されたユーザーマニュアルとサンプル。

---

### フェーズ 2: MD-WBSリッチ形式の活用と双方向性強化

**（期間: 約2-3週間）:**

* **目的**:
  * MD-WBS（リッチ形式）からWBSタスク記法への変換を実現し、編集の柔軟性を高める。
  * 全体の堅牢性を高めるためのテスト拡充。
  * フロントマターの書き出し対応。
* **主要タスク**:
    1. **スクリプト5: `ConvertTo-WbsTaskNotationFromRichMdWbs.ps1`（MD-WBSリッチ → WBSタスク記法）**
        * MD-WBS（リッチ形式）のMarkdown構造と属性リストをパースし、WBSタスク記法の1行カンマ区切り形式に変換。
        * **フロントマター活用**: MD-WBS（リッチ形式）のフロントマターから主要な情報を読み取り、出力するWBSタスク記法ファイルのフロントマターとして（可能な範囲で）書き出す。
        * このスクリプトの出力は、フェーズ0の `ConvertTo-ExcelFromWbsTaskNotation.ps1` の入力として利用可能。
    2. **スクリプト2（`ConvertTo-WbsTaskNotationFromExcel.ps1`）改良**: ExcelからWBSタスク記法を生成する際に、基本的なプロジェクト情報（ファイル名などから）をフロントマターとして出力するオプションを追加。
    3. **共通モジュール `MyCommonFunctions` 拡張**: フロントマター生成・書き出し機能。
    4. **テスト拡充**:
        * 各変換パスのエッジケースを考慮したテストケースを追加。
        * Pester等を用いたユニットテストの導入検討（とくに `MyCommonFunctions` のパーサーや日付処理）。
    5. **コードリファクタリングと最適化**: 全体的なコード品質の向上。
    6. **ドキュメント**: スクリプト5の使用法、MD-WBS（リッチ形式）の編集と変換フロー、フロントマターの書き出しについて追記。
* **成果物**:
  * 動作する `ConvertTo-WbsTaskNotationFromRichMdWbs.ps1`。
  * フロントマター書き出しに対応したスクリプトと `MyCommonFunctions`。
  * テストが拡充されたツール群。
  * Pesterテスト（導入した場合）。
  * 総合的なユーザーマニュアル。

---

### フェーズ 3（以降）: 継続的改善と高度化

* **目的**: ユーザーフィードバックの収集と反映、バグ修正、より高度な機能の検討・実装。
* **タスク例**:
  * 詳細なエラーハンドリングとユーザーへの分かりやすいエラーメッセージ。
  * パフォーマンスチューニング。
  * より複雑なMD-WBS（リッチ形式）のパース対応（カスタム属性など）。
  * 設定ファイルによる動作カスタマイズ（祝日リストパスのデフォルト設定、フロントマターキーのマッピングなど）。
  * VS Code連携の強化（例: 専用のタスクプロバイダーやLinter補助など、これは難易度高）。
  * `ImportExcel` モジュールの利用検討（COMオブジェクトへの依存を減らすため、ただし環境構築のハードルは上がる可能性）。

**このロードマップのポイント**:

* **WBSタスク記法の安定化**: フェーズ0でWBSタスク記法の核となる入出力を固め、VS Codeでの編集のしやすさ（Markdownとしての妥当性）を確保する。
* **フロントマターの段階的導入**:
  * フェーズ0: 無視（読み飛ばし）。
  * フェーズ1: 読み取りのみ活用。
  * フェーズ2: 書き出しにも対応。
    これにより、ユーザーは徐々にフロントマターの便利さを享受でき、シンプルなファイルも引き続き利用可能。
* **堅牢な基盤**: `MyCommonFunctions` モジュールにロジックを集約し、テストを重ねることで、ツール全体の安定性を高める。
* **ユーザー価値の早期提供**: 各フェーズで具体的な変換機能がリリースされるため、ユーザーは早期からツールを使い始めることができる。

このロードマップにより、着実に機能が充実し、かつ安定したツールセットを構築していくことが期待できます。

---

## 変更履歴

| 日付       | バージョン | 担当者      | 変更内容                                                                 |
|------------|------------|-------------|--------------------------------------------------------------------------|
| 2025-05-30 | 1.0        | AI/ユーザー | 初版作成。WBSタスク記法を軸とした開発フェーズ、フロントマターの段階的導入方針などを定義。 |

---
