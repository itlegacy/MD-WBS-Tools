# MD-WBS-Tools 開発ロードマップ (simple-md-wbs 中心アプローチ + VBA連携)

## 全体方針

* **`simple-md-wbs` を中核に:** すべてのWBSデータは`simple-md-wbs`記法（`docs/12_wbs_task_syntax_specification.md`参照）をマスターデータとし、この記法からの変換およびこの記法への変換を基本とする。
* **Markdown互換性と視覚化:** `simple-md-wbs` は標準的なMarkdown構文を最大限活用し、VS Code等の`エディタ`での編集容易性と、Markmap等によるリアルタイムな構造視覚化を重視する。
* **標準CSV連携をPowerShellの責務に:** PowerShellスクリプトは、`simple-md-wbs` の論理構造を忠実に反映した「標準順序CSV」の生成と解釈に注力する。
* **Excel特殊表示はVBAマクロで対応 (オプション):** Excelのグループ化機能に最適化されたタスクの並び順など、表示特化の処理は、別途開発するオプションのExcel VBAマクロに委任する。
* **段階的開発とテスト重視:** 各フェーズで具体的な価値を提供し、コア機能の品質を確保するために単体テスト・結合テストを重視する。
* **PowerShellモジュール化:** 共通処理は `MyCommonFunctions` モジュールに集約し、保守性と再利用性を高める。

---

## 開発フェーズ

* **目的:**
  * 新しい `simple-md-wbs` 記法の仕様を正式にドキュメント化する。
  * プロジェクト全体のドキュメント（README、要件定義、ロードマップ等）を新しい方針に合わせて更新する。
  * プロトタイプで検証済みの `simple-md-wbs` → CSV変換のコアロジックを清書し、基本的なPowerShellスクリプト/モジュール構造を整備する。
* **主要タスク:**
    1. **`simple-md-wbs` 仕様書（`12_wbs_task_syntax_specification.md`）の確定。**（最優先）
    2. **本ロードマップ（`01_project_roadmap.md`）の確定。**
    3. **README（`00_README.md`）の更新。**
    4. **要件定義書（`10_requirements_definition.yaml`）の更新。**
    5. プロトタイプスクリプト（`ParseSimpleMdWbs.ps1`）を正式なスクリプト（`Convert-SimpleMdWbsToCsv.ps1`）としてリファクタリング。
        * PowerShellベストプラクティス適用（CmdletBinding, `パラメータ`検証等）。
        * エラーハンドリング強化（ファイルIO、パースエラー時のNULL扱いとVerbose/Warning出力）。
    6. 共通関数（`Get-DisplaySortKey`, `Parse-Attributes`）を `MyCommonFunctions` モジュールへ移動し、モジュールマニフェスト整備。
    7. 基本的な単体テストの作成（`MyCommonFunctions` 内の主要関数を対象）。
* **成果物（このフェーズで確実に手にしたいもの）:**
  * 最新化された主要ドキュメント群。
  * 基本的な `simple-md-wbs` → CSV変換機能を持つ、リファクタリング済みのPowerShellスクリプトとモジュール。
  * コア関数の基本的な単体テスト。

---

### フェーズ 1: `SimpleMdWbs` → 標準順序CSV 変換機能の完成度向上

* **目的:**
  * `simple-md-wbs` から標準順序CSVへの変換機能について、依存関係の解決を含め、より実用的なレベルまで完成度を高める。
  * ユーザーが実際に利用開始できるレベルの品質とドキュメントを提供する。
* **主要タスク:**
    1. **依存関係解決機能の実装:**
        * `simple-md-wbs` 内の「先行タスクユーザー記述ID」を解決し、対応するアイテムの「表示用ソートキー」をCSVに出力する。
        * 先行タスクの名称もCSVに出力する。
        * 未解決IDに対する警告処理。
    2. **CSV出力列の最終調整:** Excelテンプレート（`wbs-gantt-template.xlsx`）との整合性を考慮し、CSVの列名と出力内容を最終化する。
    3. **結合テストの拡充:** さまざまなパターンの `simple-md-wbs` ファイルを用いた結合テストを実施し、出力される標準順序CSVの正確性を検証する。
    4. **ユーザーマニュアル（`docs/user_manual/`）の作成:**
        * `simple-md-wbs` の記述方法詳細。
        * `Convert-SimpleMdWbsToCsv.ps1` の使用方法、`パラメータ`説明。
        * 出力CSVの各列の説明。
        * トラブルシューティング情報。
    5. **（オプション）PowerShell側での日付計算機能の検討:** ユーザー入力の日付・日数と依存関係に基づく計画日付の自動計算機能の要否と実現可能性を検討（実装は次フェーズ以降でも可）。
* **成果物:**
  * 依存関係解決機能を含む、安定動作する `Convert-SimpleMdWbsToCsv.ps1`。
  * 詳細なユーザーマニュアル（`SimpleMdWbs`→標準順序CSV変換）。
  * 充実した結合テストケース群。

---

### フェーズ 2: 標準順序CSV → `SimpleMdWbs` 逆変換機能の開発

* **目的:**
  * 標準順序CSVファイルから `simple-md-wbs` 形式への逆変換機能を実現し、Excel等で編集したデータをMarkdown形式に戻せるようにする。
* **主要タスク:**
    1. **CSV入力仕様の定義:** 逆変換の入力となる標準順序CSVファイルの列構成、必須項目、データ型などを定義。
    2. **変換ロジックの設計と実装（`Convert-CsvToSimpleMdWbs.ps1`）:**
        * CSVの「タスクID」（表示用ソートキー）からMarkdownの階層構造（見出しレベル、リストネスト）を復元するロジック。
        * CSVの各列の値を `simple-md-wbs` の属性（`%%`行またはHTMLコメント内）にマッピングするロジック。
    3. **単体テスト・結合テスト:** 標準順序CSV入力ファイルに対する `simple-md-wbs` 出力文字列を検証するテストを作成。
    4. **ユーザーマニュアルの更新:** 標準順序CSVファイルの編集ルール、逆変換スクリプトの使い方などを追記。
* **成果物:**
  * 動作する `Convert-CsvToSimpleMdWbs.ps1`。
  * 逆変換機能に関するユーザーマニュアル。
  * 逆変換機能のテストケース群。

---

### フェーズ 3: (並行または後続) Excel表示最適化VBAマクロの開発 (オプション)

* **目的:**
  * PowerShellスクリプトが出力した標準順序CSVを、Excelのグループ化機能と親和性の高い表示順序に変換するVBAマクロ、およびその逆変換を行うマクロを開発する。
* **主要タスク:**
    1. Excelグループ化用順序の仕様定義（IDの一時的書き換えルール、ソートキー、必要な列など）。
    2. VBAマクロの設計と実装（標準順序→グループ化用順序、グループ化用順序→標準順序）。
    3. VBAマクロのテスト。
    4. VBAマクロの配布方法検討（マクロ付きテンプレート、アドインなど）。
    5. ユーザーマニュアルにVBAマクロの使用方法を追記。
* **成果物:**
  * 動作するExcel VBAマクロ（またはマクロを含むExcelテンプレート）。
  * VBAマクロ利用に関するドキュメント。

---

### フェーズ 4: 安定化、改善、および拡張機能検討 (旧フェーズ3の内容を一部移行)

* **目的:**
  * これまでに開発した機能のバグ修正、パフォーマンス改善、ユーザービリティ向上。
  * ユーザーからのフィードバックを収集し、反映する。
  * 将来的な拡張機能の検討と、可能であれば一部実装。
* **タスク例:**
  * **PowerShell側での日付自動計算機能の実装**（フェーズ1で検討し、優先度が高い場合）。
    * 祝日リストの取り扱い。
    * Excelの計算ロジックとの整合性。
  * **Markwhen連携機能の再検討と実装**（もし需要と実現性があれば）。
    * `simple-md-wbs` からMarkwhen形式への変換スクリプト作成。
  * より高度なエラーハンドリングとユーザーへのフィードバック強化（PowerShell側）。
  * テストカバレッジの向上（PowerShell側）。
  * **（超長期的検討）Excel COMオブジェクトによる直接連携:** CSVファイルを介さない、よりシームレスなExcel連携。ただし、VBAマクロで十分な場合は優先度低。
* **成果物:**
  * より堅牢で使いやすいツールセット。
  * 拡充されたドキュメントとテスト。
  * （実装した場合）追加された拡張機能。

---

## 変更履歴

| 日付       | バージョン | 担当者    | 変更内容 |
|------------|------------|-----------|----------|
| 2025-06-02 | 2.2        | IT Legacy | VBAマクロ連携によるExcel表示最適化の方針を反映。PowerShellの責務を明確化し、VBA開発フェーズを追加。 |
| 2025-05-31 | 2.0        | IT Legacy | `simple-md-wbs` 中心アプローチへの移行を反映。CSV連携優先、COM連携は将来検討へ。 |
| 2025-05-30 | 1.0        | IT Legacy | 初版作成。WBSタスク記法を軸とした開発フェーズ、フロントマターの段階的導入方針などを定義。 |

---
