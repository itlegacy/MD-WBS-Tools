# SimpleMdWbs 記法 仕様書 Ver. 0.1 (2025-05-31)

## 1. はじめに

### 1.1. 本仕様書の目的

本仕様書は、MarkdownをベースとしたWBS (Work Breakdown Structure) 記述法である `simple-md-wbs` の構文、各要素の意味、および記述ルールを定義します。
この記法で記述されたファイルは、関連ツールによって解釈され、CSVファイルへの変換などが行われます。

### 1.2. `simple-md-wbs` 記法の概要と特徴

`simple-md-wbs` は、以下の特徴を持つWBS記述方法です。

* **Markdownベース:** 標準的なMarkdownの構文（主に見出しとリスト）を利用するため、多くのMarkdown`エディタ`で容易に記述・編集が可能です。
* **Markmap連携:** Markdownの階層構造は、[Markmap](https://markmap.js.org/) などのツールを利用することで、マインドマップ風のツリーとしてリアルタイムに視覚化できます。
* **階層表現の容易さ:** 見出しレベルとリストのネストにより、WBSの階層構造を直感的に表現できます。
* **属性情報の分離:** タスクやカテゴリの名称と、日付・担当者などの詳細な属性情報を分離して記述するため、Markmap表示時のノード名を簡潔に保ちつつ、必要な情報を管理できます。

## 2. 基本構造とルール

### 2.1. ファイルエンコーディング

`simple-md-wbs` ファイルは、**UTF-8** エンコーディングで保存することを推奨します（とくにUTF-8 with BOM）。

### 2.2. 階層表現

WBSの階層は、Markdownの見出しレベルとリストアイテムによって以下のように定義されます。

* **プロジェクト名 (レベル1):**
  * MarkdownのH1見出し (`#`) を使用します。
  * 例: `# プロジェクトX`
* **大分類 (レベル2):**
  * MarkdownのH2見出し (`##`) を使用します。
  * 例: `## D1_大分類A`
* **中分類 (レベル3):**
  * MarkdownのH3見出し (`###`) を使用します。
  * 例: `### D1C1_中分類A1`
* **小分類 (レベル4):**
  * MarkdownのH4見出し (`####`) を使用します。
  * 例: `#### D1C1S1_小分類A1-1`
* **タスク (レベル5):**
  * 対応するカテゴリ（小分類、中分類、または大分類）の見出しの下に、Markdownのリストアイテム (`-` または `*`) として記述します。
  * 例: `- タスク名1`

### 2.3. 見出しのルール

* **必須:** 各見出し行 (H1, H2, H3, H4) の**直後には、必ず1行の空行を挿入してください。**
* **推奨:** 各見出し行の前にも空行を挿入することを強く推奨します。これにより、多くのMarkdownパーサーとの互換性が向上します。

## 3. 属性の記述方法

各カテゴリ（プロジェクト名、大分類、中分類、小分類）および各タスクは、以下の属性情報を保持できます。

### 3.1. カテゴリ属性行 (`%%`行)

各カテゴリ（H1～H4見出しで定義されるもの）の属性情報は、見出し直後の必須の空行の**次の行**に、`%%` で始まる行（属性行）として記述します。

* **書式:**

    ```plaintext
    %% ユーザー記述ID,終了日,日数,依存種別,先行タスクID,状態,進捗率,担当者,担当組織,開始日実績,コメント
    ```

* **例:**

    ```markdown
    ## D1_大分類A

    %% D1,2025-07-31,40,,,計画中,10%,PM田中,全体統括,2025-06-01,最重要フェーズ
    ```

* **詳細:**
  * 行は必ず `%%` とそれに続く半角スペース（またはタブ）で開始します。
  * 最初のカンマ区切りフィールドは、そのカテゴリの「ユーザー記述ID」です。
  * 以降のフィールドは、「3.3. 属性フィールド一覧と詳細」で定義された順序でカンマ区切りで記述します。
  * 属性を省略する場合は、フィールドを空のままカンマで区切ります (例: `ValueA,,ValueC`)。
  * 最後のカンマの後のすべての文字列が「コメント」として扱われます。コメント内にカンマを含むことも可能です。

### 3.2. タスク属性 (HTMLコメント内)

各タスク（リストアイテムで定義されるもの）の属性情報は、タスク名の直後に `スペース + <!-- 属性情報 -->` の形式でHTMLコメント内に記述します。

* **書式:**

    ```markdown
    - タスク名 <!-- ユーザー記述ID,終了日,日数,依存種別,先行タスクID,状態,進捗率,担当者,担当組織,開始日実績,コメント -->
    ```

* **例:**

    ```markdown
    - A部署ヒアリング準備 <!-- D1C1S1T1,2025-06-07,2,,,未着手,0,鈴木担当,要件定義チーム,2025-06-03,質問票作成 -->
    ```

* **詳細:**
  * タスク名とHTMLコメントの間には、必ず1つ以上の半角スペースを挿入します。
  * HTMLコメントは `<!--` で始まり、`-->` で終わります。
  * HTMLコメント内の最初のカンマ区切りフィールドは、そのタスクの「ユーザー記述ID」です。
  * 以降のフィールドは、「3.3. 属性フィールド一覧と詳細」で定義された順序でカンマ区切りで記述します。
  * 属性を省略する場合は、フィールドを空のままカンマで区切ります。
  * HTMLコメント内の最後のカンマの後のすべての文字列が「コメント」として扱われます。コメント内にカンマを含むことも可能です。
  * **注意:** HTMLコメントの開始マーカー `<!--` と終了マーカー `-->` は正しく対応させてください。コメント内に `-->` という文字列を含めると、そこでコメントが終了したと解釈される可能性があります。

### 3.3. 属性フィールド一覧と詳細 (カテゴリ属性行・タスク属性共通)

以下の表は、属性行 (`%%`) およびHTMLコメント属性内で使用される属性フィールドの定義と順序を示します。

| No. | フィールド名 | 型      | 必須/任意 | 説明                                                                 | 例                                 |
|-----|--------------|---------|-----------|----------------------------------------------------------------------|------------------------------------|
| 1   | **ユーザー記述ID** | String | 必須 | アイテムを識別するID。依存関係指定に使用。ファイル内でユニーク推奨。 | `D1`, `D1C1S1T2`                   |
| 2   | 終了日       | Date    | 任意      | YYYY-MM-DD形式の締切日。                                             | `2025-07-31`                       |
| 3   | 日数         | Integer | 任意      | 所要日数 (作業日数)。ExcelのU列(日数入力)に対応。                    | `5`, `20`                          |
| 4   | 依存関係種別 | String  | 任意      | `"先行"` または `"後続"`。先行タスクとの関係を示す。                 | `先行`                             |
| 5   | 先行タスクID | String  | 任意      | 依存する先行タスクの「ユーザー記述ID」。複数ある場合はカンマ区切り非推奨(※)。 | `D1C1S1T1`               |
| 6   | 状態         | String  | 任意      | タスクやカテゴリの状態 (例: `未着手`, `計画中`, `実施中`, `完了`)。  | `計画中`                           |
| 7   | 進捗率       | String  | 任意      | パーセント表記 (`50%`) または小数表記 (`0.5`) を許容。               | `50%`, `0.75`                      |
| 8   | 担当者       | String  | 任意      |                                                                      | `PM田中`, `佐藤リーダー`           |
| 9   | 担当組織     | String  | 任意      |                                                                      | `全体統括`, `要件定義チーム`       |
| 10  | 開始日実績   | Date    | 任意      | YYYY-MM-DD形式の実際に開始した日付。                                 | `2025-06-01`                       |
| 11  | コメント     | String  | 任意      | 当該アイテムに関する自由な注釈。このフィールド以降の文字列すべて。   | `これは重要なタスクです, 詳細別途` |

TODO:※ 先行タスクIDの複数指定については、現状のプロトタイプでは単一指定のみを想定。複数指定を許容する場合、ツールの対応と仕様の明確化が必要

## 4. 無視される行

以下の行は、`simple-md-wbs` パーサーによって無視され、WBS構造やデータとしては解釈されません。

* `%%` で始まらない行（属性行ではない）
* `-` または `*` で始まらない行（リストアイテムではない）
* `#` で始まらない行（見出しではない）
* 上記の無視される行に含まれるHTMLコメントも同様に無視されます。
* 連続する空行は、Markdownの一般的な解釈に従い、通常は1行の空行として扱われるか、表示に影響を与えません。

ユーザーは、WBSデータのブロック間に、これらの行を個人的なメモ、区切り線（`---` など）、または整形のための空行として自由に挿入できます。

## 5. 記述サンプル

```markdown
# プロジェクトX

これはプロジェクト全体の概要メモです。この行はツールに無視されます。
<!-- この行のHTMLコメントもツールに無視されます -->

## D1_要件定義フェーズ

%% D1,2025-07-31,40,,,計画中,10%,PM田中,全体統括,2025-06-01,最重要フェーズ、リソース確保を優先

### D1C1_ヒアリング実施

%% D1C1,2025-06-30,20,,,未着手,0%,佐藤リーダー,要件定義チーム,2025-06-03,顧客との日程調整が鍵

#### D1C1S1_A部署ヒアリング

%% D1C1S1,2025-06-15,5,,,,,,鈴木担当,要件定義チーム,,A部署の業務フローを詳細に把握する

- A部署ヒアリング準備 <!-- D1C1S1T1,2025-06-07,2,,,未着手,0,鈴木担当,要件定義チーム,2025-06-03,質問票作成、アポ取り -->
- A部署ヒアリング実施と議事録作成 <!-- D1C1S1T2,2025-06-15,3,先行,D1C1S1T1,実施中,50%,鈴木担当,要件定義チーム,2025-06-10,議事録は翌日までに共有 -->

#### D1C1S2_B部署ヒアリング

%% D1C1S2,2025-06-30,5,,,,,,高橋担当,要件定義チーム,2025-06-20,B部署はとくにシステム連携が多い

- B部署ヒアリング準備 <!-- D1C1S2T1,2025-06-24,2,,,未着手,0%,高橋担当,要件定義チーム,2025-06-20,A部署のヒアリング結果も参考に -->
- B部署ヒアリング実施と議事録作成 <!-- D1C1S2T2,2025-06-30,3,先行,D1C1S2T1,,,,高橋担当,要件定義チーム,2025-06-25, -->

---

上記はヒアリング関連のタスクです。この区切り線やテキストも無視されます

---

### D1C2_要件定義書作成

%% D1C2,2025-07-31,25,先行,D1C1,,,未着手,0%,佐藤リーダー,要件定義チーム,2025-07-01,ヒアリング結果を元に作成開始

- 要件定義書ドラフト作成 <!-- D1C2T1,2025-07-20,15,,,作成中,30%,渡辺担当,要件定義チーム,2025-07-01,複数名で分担執筆 -->
- 社内レビュー <!-- D1C2T2,2025-07-25,3,先行,D1C2T1,レビュー待ち,,,,要件定義チーム,2025-07-21,関係各部署へレビュー依頼 -->
- 要件定義書FIX <!-- D1C2T3,2025-07-31,2,先行,D1C2T2,,,,佐藤リーダー,要件定義チーム,2025-07-28,最終承認を得る -->

## D2_設計フェーズ

%% D2,2025-09-30,40,先行,D1,未着手,0,PM田中,全体統括,2025-08-01,要件定義FIX後に開始

### D2C1_基本設計

%% D2C1,2025-08-31,20,,,未着手,,,,設計チーム,,

- 基本設計書作成 <!-- D2C1T1,,,,,,,,,,基本設計は特に重要、時間をかける -->
    <!-- 上の行のタスクは、属性が省略されている例（IDのみで他は空）。ツールはID以外をNULLとして扱う -->
- 基本設計レビュー <!-- D2C1T2,,,,,先行,D2C1T1,,,,設計チーム,, -->
    <!-- HTMLコメントの属性が不正な場合の例。ツールはこのタスクの属性をNULLとして扱う想定 -->
    <!-- D2C1T2-invalid-comment-format -->

### D2C2_詳細設計

%% D2C2,2025-09-30,20,先行,D2C1,,,,設計チーム,,

- 詳細設計タスクA <!-- D2C2T1,2025-09-15,,,,,,,,,, -->
- 詳細設計タスクB <!-- D2C2T2,2025-09-30,,先行,D2C2T1,,,,,,先行タスクIDが存在しない場合の例(仮にD2C2T1が存在しない場合) -->

<!-- この最終行のコメントも無視される -->
```

## 6. 改訂履歴

| バージョン | 日付       | 変更者    | 変更内容                                                     |
|------------|------------|-----------|--------------------------------------------------------------|
| 0.1        | 2025-05-31 | IT Legacy | 初版ドラフト作成。プロトタイプの結果とここまでの議論を反映。 |
|            |            |           |                                                              |
