# SimpleMdWbs 記法 仕様書 Ver. 0.9 (2025-06-04)

## 1. はじめに

### 1.1. 本仕様書の目的

本仕様書は、`simple-md-wbs` 記法を用いて記述されたWBS（Work Breakdown Structure）ファイルの構造と記法を定義します。この仕様書に従うことで、WBSファイルを一貫性のある形式で作成し、ツールによる解析や変換を容易にすることが可能になります。

### 1.2. `simple-md-wbs` 記法の概要と特徴

`simple-md-wbs` 記法は、Markdownをベースとした軽量なWBS記述記法です。

* テキスト形式のため、バージョン管理システムとの連携が容易です。
* 可読性が高く、特別な`エディタ`を必要としません。
* 特定のツールに依存せず、汎用的に利用できます。

## 2. 基本構造とルール

### 2.1. ファイルエンコーディング

`simple-md-wbs` ファイルは、**UTF-8** エンコーディングで保存してください。**UTF-8 with BOM** を推奨します。

### 2.2. 階層表現

WBSの階層構造は、Markdownの見出しとリストを用いて表現します。

* プロジェクト名（H1見出し: `# プロジェクト名`）
* 大分類（H2見出し: `## 大分類名`）
* 中分類（H3見出し: `### 中分類名`）
* 小分類（H4見出し: `#### 小分類名`）
* タスク（リストアイテム: `- タスク名` または `* タスク名`）

### 2.3. 見出しのルール

* **必須:** 各見出し行（H1, H2, H3, H4）の**直後には、必ず1行の空行を挿入してください。**
* **推奨:** 各見出し行の前にも空行を挿入することを強く推奨します。

## 3. 属性の記述方法

### 3.0. ID体系について (ツール生成ID)

本ツールは、Markdownファイル内の階層構造に基づいて、各アイテム（プロジェクト、カテゴリ、タスク）に対して内部的に2種類のIDを生成・利用します。

* **ソート用ID（「番号」列）**: `00.00.00.00`（プロジェクト）、`01.00.00.00`（大分類）、`01.01.00.00`（中分類）、`01.01.01.00`（小分類）、`01.01.01.01`（タスク）のように、ゼロ埋めされた最大4セグメントで構成されるIDです。これはCSV出力時の「番号」列にそのまま出力され、Excelなどでの正確な階層ソートに使用されます。
* **表示用タスクID（「タスクID」列）**: より簡潔な表示を目的としたIDです。
  * プロジェクト: `0`
  * 大分類: `1`（そのプロジェクト内の大分類連番、先頭ゼロなし）
  * 中分類: `1.1`（そのプロジェクト内の大分類連番.中分類連番、各セグメント先頭ゼロなし）
  * 小分類: `1.1.1`（そのプロジェクト内の大分類連番.中分類連番.小分類連番、各セグメント先頭ゼロなし）
  * タスク: `1.1.1.1`（そのプロジェクト内の大分類連番.中分類連番.小分類連番.タスク連番 の4セグメント形式、各セグメント先頭ゼロなし）
  このIDは、ソート用IDから不要なゼロやセグメントを除去して生成され、CSV出力時の「タスクID」列に出力されます。

各カテゴリ（プロジェクト名、大分類、中分類、小分類）および各タスクは、以下の属性情報を保持できます。
**カテゴリ属性とタスク属性は、同じフィールドセットと順序を共有します。**

### 3.1. カテゴリ属性行（`%%`行）

カテゴリ（プロジェクト名、大分類、中分類、小分類）の属性は、`%%` で始まる行に記述します。

* 書式:

    ```markdown
    %% ユーザー記述ID,開始日（入力）,終了日（入力）,日数（入力）,関連タスク種別,関連タスクID,開始日（実績）,終了日（実績）,進捗率,担当者,担当組織,最終更新日,コメント
    ```

* 例:

    ```markdown
    ## 大分類X - 開始日と日数を入力し、先行タスクを指定

    %% CAT_X,2025-07-01,,20,先行,PROJ_ID,2025-07-02,,30%,担当X,チームX,2025-07-01,終了日（入力）は空。プロジェクトPROJ_IDに先行。
    ```

    ```markdown
    ## 大分類Y - 開始日と終了日を入力し、後続タスクを指定

    %% CAT_Y,2025-07-22,2025-07-26,,後続,CAT_X,,,,担当Y,チームY,2025-07-21,日数（入力）は空。CAT_Xの後続。
    ```

    ```markdown
    ## 大分類Z - 日数と終了日を入力 (開始日は空)
    %% CAT_Z,,2025-08-10,5,,,,,,,担当Z,チームZ,2025-07-30,開始日（入力）は空。
    ```

### 3.2. タスク属性（HTMLコメント内）

タスクの属性は、タスク名のリストアイテムに続くHTMLコメント内に記述します。

* 書式:

    ```markdown
    - リストアイテム <!-- ユーザー記述ID,開始日（入力）,終了日（入力）,日数（入力）,関連タスク種別,関連タスクID,開始日（実績）,終了日（実績）,進捗率,担当者,担当組織,最終更新日,コメント -->
    ```

* 例:

    ```markdown
    - タスクA <!-- TSK001,2025-06-10,2025-06-12,3,,,2025-06-10,,0%,鈴木担当,開発チーム,2025-06-11,初期調査タスク -->
    ```

* **注意:** HTMLコメントは、タスク名のリストアイテムと同じ行に記述する必要があります。

### 3.3. 属性フィールド一覧と詳細（カテゴリ・タスク共通）

以下の表は、属性行 (`%%`) およびHTMLコメント属性内で使用される属性フィールドの定義と順序を示します。カテゴリ属性とタスク属性は、同じフィールドセットと順序を共有します。

| No. | フィールド名       | 型 (ツール内部) | 必須/任意 | 説明 (Excel連携先や入力形式を明記)                                                     | 例 |
|-----|--------------------|-----------------|-----------|----------------------------------------------------------------------------------------|----|
| 1   | **ユーザー記述ID** | String          | 必須      | アイテムを識別するID。依存関係指定に使用。ファイル内でユニーク推奨。                   | `D1`, `TSK001` |
| 2   | 開始日（入力）     | String          | 任意      | ExcelのS列「開始入力」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-06-01` |
| 3   | 終了日（入力）     | String          | 任意      | ExcelのT列「終了入力」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-07-31` |
| 4   | 日数（入力）       | String          | 任意      | ExcelのU列「日数入力」に対応。数値の文字列。                                           | `5`, `20` |
| 5   | 関連タスク種別     | String          | 任意      | `先行` または `後続`。CSVのF列「関連種別」に対応。                                     | `先行` |
| 6   | 関連タスクID       | String          | 任意      | 依存するタスクの「ユーザー記述ID」。CSVのG列「関連番号」の元データ。現状単一指定のみ。 | `TSK001`, `D1` |
| 7   | 開始日（実績）     | String          | 任意      | ExcelのZ列「開始実績」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-06-05` |
| 8   | **終了日（実績）** | **String**      | **任意**  | **ExcelのAA列「修了実績」に対応。YYYY-MM-DD形式の文字列。タスク完了日。**              | **`2025-08-15`** |
| 9   | 進捗率             | String          | 任意      | ExcelのY列「進捗実績」に対応。パーセント表記 (例: `50%`) のみ許容。                    | `50%` |
| 10  | 担当者             | String          | 任意      | ExcelのP列「担当者名」に対応。                                                         | `PM田中`, `佐藤リーダー` |
| 11  | 担当組織           | String          | 任意      | ExcelのO列「担当組織」に対応。                                                         | `全体統括`, `要件定義チーム` |
| 12  | 最終更新日         | String          | 任意      | ExcelのR列「最終更新」に対応。ユーザーによる手入力情報。YYYY-MM-DD形式の文字列。       | `2025-06-10` |
| 13 | コメント | String | 任意 | ExcelのJ列「コメント」(アクションプラン)に対応。このフィールド以降の文字列すべて。カンマ (`,`) を含むことも可能。 | `これは重要なタスクです, 詳細別途` |

## 4. 無視される行

以下の行は、ツールによって無視されます。

* 空行
* コメント行（`<!-- コメント -->`）
* 属性行で始まらない行（`%%` で始まらない行）
* リストアイテムで始まらない行（`-` または `*` で始まらない行）
* 見出しで始まらない行（`#` で始まらない行）

ユーザーは、WBSデータのブロック間に、これらの行を個人的なメモ、区切り線（`---` など）、または整形のための空行として自由に挿入できます。

## 5. 記述サンプル

以下は、`simple-md-wbs` 記法で記述されたWBSのサンプルです。**このサンプルは最新の13属性の定義と順序にしたがっています。**

```markdown
# プロジェクトAlpha <!-- 2.2. プロジェクト名 (H1見出し) -->

<!-- 2.3. 見出し後の必須の空行 -->

## DA_設計フェーズ <!-- 2.2. 大分類 (H2見出し) -->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01,2025-07-01,2025-08-31,40,,,2025-07-05,,設計リード,設計チーム,2025-07-03,基本設計と詳細設計を含む <!-- 3.1. カテゴリ属性行 (13属性) -->
<!-- 属性順: UID,SD(in),ED(in),Dur(in),DepType,DepID,SD(act),ED(act),Progress,Assignee,Org,LastUpdate,Comment -->

<!-- 2.3. 見出し後の必須の空行 -->
### DA01CA_基本設計 <!-- 2.2. 中分類 (H3見出し) -->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01,2025-07-01,2025-07-31,20,,,,,,設計担当A,設計チーム,2025-07-02,主要機能の骨格設計

<!-- 2.3. 見出し後の必須の空行 -->
#### DA01CA01SA_UI設計 <!-- 2.2. 小分類 (H4見出し) -->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01SA01,2025-07-01,2025-07-15,10,,,,,,,,UI/UXチーム,2025-07-01,画面遷移とコンポーネント定義

- UIモックアップ作成 <!-- 3.2. タスク属性 (HTMLコメント内, 13属性) --> <!-- TSK_UI_001,2025-07-01,2025-07-08,5,,,2025-07-02,,0%,デザイナーA,UI/UXチーム,2025-07-02,Figmaで作成 -->
- UIレビューとフィードバック <!-- TSK_UI_002,2025-07-09,2025-07-15,3,先行,TSK_UI_001,2025-07-09,,0%,設計リード,設計チーム,2025-07-09,関係者レビュー -->

<!-- 2.3. 見出し後の必須の空行 -->
#### DA01CA01SB_DB設計

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01SB01,2025-07-16,2025-07-31,10,,,,,,,,DBA担当,設計チーム,2025-07-15,ER図とテーブル定義

- テーブル定義作成 <!-- TSK_DB_001,2025-07-16,2025-07-24,7,,,,0%,エンジニアB,DBA担当,2025-07-16,主要エンティティの洗い出し -->

--- <!-- 4. 無視される行の例 -->
設計フェーズはここまで。 <!-- 4. 無視される行の例 -->
---
```

## 6. 改訂履歴

| バージョン | 日付       | 変更者    | 変更内容                                                                                                                  |
|------------|------------|-----------|---------------------------------------------------------------------------------------------------------------------------|
| 0.9        | 2025-06-04 | IT Legacy | 日付・日数入力のサンプルをより実践的なパターンに修正。依存関係の記述例を明確化。関連する注釈を修正・追記。バージョン更新。 |
| 0.8        | 2025-06-04 | IT Legacy | 日付・日数入力のサンプルコードを修正し、3つのうち2要素のみ入力するパターンを増やした。依存関係の例も日付を調整。注釈追加。バージョン更新。 |
| 0.7        | 2025-06-03 | IT Legacy | カテゴリ・タスク属性の順序と内容を最終版の13属性に統一。書式例、具体例、記述サンプルをすべて最新仕様に更新。フィールドNo.3の修正。バージョン更新。 |
| 0.6        | 2025-06-03 | IT Legacy | 「終了日（実績）」を属性に追加し全13属性に。Excel列名との対応を意識した説明に更新。進捗率形式、コメント位置FIX。サンプルを修正。バージョン更新。 |
| 0.4        | 2025-06-03 | IT Legacy | 「進捗率」の入力形式をパーセント表記のみに限定。「状態」属性をリストから削除。属性順序を最終化。 |
| 0.3        | 2025-06-03 | IT Legacy | 進捗率の入力形式をパーセント表記のみに限定。                                        |
