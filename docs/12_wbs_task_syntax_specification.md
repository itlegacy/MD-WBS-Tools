# WBSタスク記法 仕様書 (Ver.1.1)

## 1. はじめに

このドキュメントは、MD-WBS-Toolsプロジェクトで使用される「WBSタスク記法」の詳細な仕様を定義します。
この記法は、人間が読み書きしやすく、かつPowerShellスクリプトによる機械処理も可能な形式を目指しています。VS CodeなどのMarkdown`エディタ`での編集を主なユースケースとして想定しています。

このファイル自体が、WBSタスク情報だけでなく、ドキュメントタイトルや他の補足情報（例: AIへの指示プロンプト、変更履歴など）をMarkdown形式で含めることができるように設計されています。

## 2. ファイル形式とエンコーディング

* **ファイル拡張子**: `.md`
* **エンコーディング**: UTF-8（BOMなしを推奨）

## 3. 全体構造と処理対象セクション

PowerShellスクリプトがWBSタスク情報を抽出する際のファイル全体の解釈ルールは以下の通りです。

### 3.1. フロントマター（オプション）

* ファイルの絶対先頭（最初の見出しレベル1よりも前）には、YAML形式のフロントマターを記述できます。

    ```yaml
    ---
    project_name: "My Awesome Project"
    base_date: "2025-06-01"
    version: "1.0"
    author: "Your Name"
    ---
    ```

* **初期の扱い（ロードマップ フェーズ0-1）**: スクリプトはフロントマターが存在してもエラーとせず読み飛ばすか、`project_name` や `base_date` などの定義済みキーのみをオプションとして読み取ります。
* **将来的な扱い**: フロントマターに記述された情報は、Excel出力時のプロジェクト情報やMarkwhen生成時の基準日などに活用される予定です。

### 3.2. 見出しレベル1（`#`）の扱い

* ファイル内で最初に出現する見出しレベル1（`#`）およびその配下の内容は、**WBSタスク情報としては無視されます**。
* これは、Markdownドキュメント全体のタイトルとして利用することを想定しています。

### 3.3. 「タスク情報」セクションの特定（処理対象）

* ファイル内で、見出しレベル2（`##`）のテキストが正確に **`タスク情報`** という文字列であるセクションを探します。
* この `## タスク情報` セクションの直後から、次の見出しレベル1またはレベル2が出現するまでの間にあるMarkdownの無順序リストが、WBSタスクデータの処理対象となります。
* ファイル内に `## タスク情報` という見出しが存在しない場合、そのファイルからはWBSタスク情報は抽出されません（またはエラーとして扱います）。
* `## タスク情報` が複数存在する場合、最初に出現したもののみを処理対象とするか、全てを処理対象とするかはスクリプトの実装によりますが、現状は**最初の一つのみを処理対象とする**ことを推奨します。

### 3.4. その他のセクションの扱い

* 上記 3.2 および 3.3 で指定された箇所以外のすべての内容（他の見出しレベル2のセクション、例えば `## 生成AIプロンプト` や `## 変更履歴`、本文テキストなど）は、**WBSタスク情報としては無視されます**。

## 4. 「タスク情報」セクション内のWBSタスク記法

`## タスク情報` セクション内に記述されるWBSタスクは、以下のルールに従います。

### 4.1. 基本構造

* 各タスクは、Markdownの**無順序リストアイテム**として表現します。
  * リストマーカーはハイフン（`-`）またはアスタリスク（`*`）の後に半角スペースを1つ以上記述します。
* タスクの階層構造は、リストアイテムの**インデント**によって表現します。
  * インデントの深さ（スペースの数）でレベルを判断します。推奨は**半角スペース2つまたは4つ**を1レベルとすることですが、スクリプトは相対的なインデント差を解釈します。親子関係でインデントが深くなっていれば認識します。

### 4.2. データ要素とカンマ区切り形式

各リストアイテムのテキスト部分は、以下の要素をカンマ（`,`）で区切って記述します。要素の順序は固定です。

1. `名称`（文字列, **必須**）
2. `終了入力`（日付文字列 YYYY-MM-DD, 省略可）
3. `日数入力`（文字列 例: `5d`, 省略可）
4. `依存関係種別`（文字列 `先行` または `後続`, 省略可）
5. **`依存先行タスク指定`**（文字列, `依存関係種別`が`先行`の場合、**先行するタスクの「タスクID」または「名称」を指定**, 省略可。`依存関係種別`が`後続`の場合は通常指定不要）
6. `状態`（文字列 `未着手`, `進行中`, `完了`, 省略可, デフォルト: `未着手`）
7. `進捗率`（文字列 例: `50%` または数値 `0.5`, 省略可, デフォルト: `0%` または `0`）
8. `担当者`（文字列, 省略可）
9. `担当組織`（文字列, 省略可）
10. `固定開始日`（日付文字列 YYYY-MM-DD, 省略可）
11. `最終更新日`（日付文字列 YYYY-MM-DD, 省略可）

#### 各要素の詳細

* **名称**: タスクやカテゴリの名称。カンマを含める場合はダブルクォーテーションで囲むなどの考慮は現状不要（シンプルさを優先）。
* **終了入力**: タスクの目標完了日。`YYYY-MM-DD` 形式。
* **日数入力**: タスクの所要実作業日数。数値の後に `d` を付与（例: `3d`, `10d`）。
* **依存関係種別**:
  * `先行`: このタスクが「関連タスク名称」に依存することを示す。
  * `後続`: 「依存先行タスク指定」で特定されるタスクがこのタスクに依存することを示す（このケースでは通常、関連タスク側で`先行`を指定するため、この要素は空欄または省略されることが多い）。
* **`依存先行タスク指定`**:
  * **このタスクが依存する先行タスクを特定するための情報。**
  * **「タスクID」形式の文字列 (例: `T1.2.3`, `task-005`) または先行タスクの「名称」を文字列で指定します。**
  * スクリプトは、まずこれが既存のタスクIDと一致するかを確認し、一致しない場合はタスク名称として解決を試みます。
  * Excelから変換された場合は、基本的に先行タスクのIDがここに設定されます。手入力で名称を使うことも可能です。
* **状態**: `未着手`, `進行中`, `完了` のいずれか。
* **進捗率**: `0%`～`100%` の形式、または `0`～`1.0` の小数。
* **固定開始日**: タスクの開始日が固定されている場合の日付。`YYYY-MM-DD` 形式。
* **最終更新日**: タスク情報の最終更新日。`YYYY-MM-DD` 形式。

### 4.3. 省略ルール

* 省略可能な要素の値を指定しない場合でも、後続に値を指定する要素がある場合は、その位置を示すためにカンマを残します。
  * 例: `タスクC,,,先行,タスクA`（`終了入力`と`日数入力`を省略）
  * 例: `タスクC,,,先行,T101` (`終了入力`と`日数入力`を省略し、先行タスクをIDで指定)
  * 例: `タスクE,,,先行,先行タスクの名称` (先行タスクを名称で指定)
* 行の末尾から連続して要素を省略する場合、最後の指定要素以降のカンマは記述不要です。
  * 例: `タスクD,2025-07-15,3d`（`依存関係種別`以降すべて省略）
* `名称` 以外のすべての要素を省略することも可能です。その場合は `名称` のみ記述します。

### 4.4. 階層表現の詳細

```md
- 大項目A
  - 中項目A1
    - 小タスクA1a,2025-08-01,5d,,,,,,,,,2025-07-20
    - 小タスクA1b,2025-08-10,3d,先行,小タスクA1a  # 名称で指定
    - 小タスクA1c,2025-08-15,2d,先行,T1.1.1     # IDで指定 (仮のID)
  - 中項目A2
    - 小タスクA2a
- 大項目B
```

* `大項目A` がレベル1。
* `中項目A1`, `中項目A2` がレベル2（大項目Aの子）。
* `小タスクA1a`, `小タスクA1b` がレベル3（中項目A1の子）。

## 5. 記述例

### 5.1. シンプルな例（`## タスク情報` セクションのみ）

```markdown
## タスク情報

- プロジェクト初期化
- 要件定義,2025-06-15,5d,,,未着手,0%
- 環境構築,2025-06-10,3d,,,進行中,50%,田中一郎,開発チーム,,2025-06-01
- 設計フェーズ
- 基本設計,2025-06-30,10d,先行,要件定義
```

### 5.2. 完全なファイル構造の例

```markdown
---
project_name: "新製品開発プロジェクト"
base_date: "2025-06-01"
version: "ドキュメント v1.1"
---

# 新製品ローンチ計画 WBS

このドキュメントは新製品のローンチに向けたWBSを管理します。

## AI向け指示プロンプト

このセクションはAIがタスクリストを生成・編集する際の指示を記述する場所です。
例えば、「以下のタスクリストをWBSタスク記法に従ってフォーマットし、依存関係を明確にしてください。」など。

## タスク情報

- 市場調査フェーズ
  - 競合分析,2025-06-15,10d,,,未着手,0%,佐藤,マーケティング部,,2025-05-28
  - ターゲット顧客定義,2025-06-20,5d,先行,競合分析,未着手,0%,佐藤,マーケティング部
- 製品開発フェーズ
  - プロトタイプ開発
    - デザイン作成,2025-07-10,15d,先行,ターゲット顧客定義,進行中,30%,鈴木,開発部A,2025-06-25
    - 機能実装,2025-08-10,20d,先行,デザイン作成,未着手,0%,高橋,開発部B
  - 品質保証
    - テスト計画,2025-08-15,5d,先行,機能実装
    - 結合テスト,2025-09-05,10d,先行,テスト計画,未着手,,,,,,2025-08-16
- ローンチ準備
  - マーケティング戦略立案,2025-07-30,15d,先行,ターゲット顧客定義
  - 最終ローンチ,2025-09-30,1d,先行,結合テスト

## 変更履歴

- 2025-05-28: 初版作成 by AI Assistant
- 2025-05-29: 「市場調査フェーズ」の日程見直し by User

```

## 6. AI生成用プロンプトテンプレート（低負荷版）

以下は、与えられたタスクリストを上記の「WBSタスク記法」に変換させるよう、比較的低性能な生成AI（例: ChatGPT-3.5レベル）に指示する際のプロンプトテンプレートです。AIの能力に応じて調整してください。

---
**ENGLISH PROMPT TEMPLATE FOR AI（Low-resource models）**

Convert the following task list into a specific Markdown WBS format. Follow these rules strictly:

1. **Overall Structure**:
    * The WBS data MUST be under a Markdown heading `## Task Information`.
    * Each task is a Markdown list item starting with `-`（hyphen and a space）.
    * Hierarchy is shown by indentation（use 2 spaces for each level deeper）.

2. **Task Item Format（Comma-Separated Values）**:
    * Each list item, after the `-`, contains comma-separated fields in this EXACT order:
        1. `Name`（string, REQUIRED）
        2. `EndDate`（date YYYY-MM-DD, optional）
        3. `Duration`（string like `5d`, optional）
        4. `DependencyType`（string `先行` for "predecessor" or `後続` for "successor", optional）
        5. `RelatedTaskName`（string, name of the task it depends on, optional, use if DependencyType is present）
        6. `Status`（string `未着手` for "pending", `進行中` for "in progress", `完了` for "completed", optional, defaults to `未着手`）
        7. `Progress`（string like `50%` or number `0.5`, optional, defaults to `0%`）
        8. `Assignee`（string, optional）
        9. `Organization`（string, optional）
        10. `FixedStartDate`（date YYYY-MM-DD, optional）
        11. `LastUpdatedDate`（date YYYY-MM-DD, optional）

3. **Omitting Optional Fields**:
    * If an optional field in the middle is empty, keep its comma placeholder. Example: `Task Name,,,先行,DependencyName,,,,,,`
    * If trailing optional fields are empty, you can omit the trailing commas. Example: `Task Name,2023-12-31,5d`

4. **Example Task Line**:
    `- Task A,2023-10-31,5d,先行,Task B,進行中,25%,John Doe,Dev Team,2023-10-01,2023-09-15`

**Input Task List:**
[ここにAIに変換させたいタスクリストをプレーンテキストや別の形式で貼り付ける]

**Expected Output（Example Snippet under `## Task Information`）:**

```markdown
## Task Information

- Parent Task 1
  - Child Task 1A,2025-01-15,5d,,,未着手,0%
  - Child Task 1B,2025-01-20,3d,先行,Child Task 1A,進行中,50%
```

---

**日本語プロンプトテンプレート（低負荷版）**

以下のタスクリストを、指定されたMarkdown WBS形式に変換してください。ルールを厳密に守ってください。

1. **全体構造**:
    * WBSデータは必ず `## タスク情報` というMarkdown見出しの下に記述してください。
    * 各タスクは `-`（ハイフンとスペース）で始まるMarkdownリスト項目です。
    * 階層はインデント（各レベルでスペース2つ）で表現します。

2. **タスク項目フォーマット（カンマ区切り）**:
    * 各リスト項目の `-` の後には、以下の要素をこの順番でカンマ区切りで記述します。
        1. `名称`（文字列, **必須**）
        2. `終了入力`（日付 YYYY-MM-DD, 省略可）
        3. `日数入力`（文字列 例: `5d`, 省略可）
        4. `依存関係種別`（文字列 `先行` または `後続`, 省略可）
        5. `関連タスク名称`（文字列, 依存タスク名, 省略可, 依存関係種別がある場合使用）
        6. `状態`（文字列 `未着手`, `進行中`, `完了`, 省略可, デフォルト: `未着手`）
        7. `進捗率`（文字列 例: `50%` または数値 `0.5`, 省略可, デフォルト: `0%`）
        8. `担当者`（文字列, 省略可）
        9. `担当組織`（文字列, 省略可）
        10. `固定開始日`（日付 YYYY-MM-DD, 省略可）
        11. `最終更新日`（日付 YYYY-MM-DD, 省略可）

3. **省略可能なフィールドの扱い**:
    * 途中の省略可能なフィールドが空の場合でも、カンマは残してください。例: `タスク名,,,先行,依存タスク名,,,,,,`
    * 末尾の連続する省略可能なフィールドが空の場合、末尾のカンマは省略可能です。例: `タスク名,2023-12-31,5d`

4. **タスク行の例**:
    `- タスクA,2023-10-31,5d,先行,タスクB,進行中,25%,山田太郎,開発チーム,2023-10-01,2023-09-15`

**入力タスクリスト:**
[ここにAIに変換させたいタスクリストをプレーンテキストや別の形式で貼り付ける]

**期待される出力（`## タスク情報` 配下の抜粋例）:**

```markdown
## タスク情報

- 親タスク1
  - 子タスク1A,2025-01-15,5d,,,未着手,0%
  - 子タスク1B,2025-01-20,3d,先行,子タスク1A,進行中,50%
```
