# WBSタスク構文仕様書（MD-WBS-Tools）

バージョン: 1.1（2025-06-11改訂）

## 1. はじめに

### 1.1. 本仕様書の目的

本仕様書は、`simple-md-wbs` 記法を用いて記述されたWBS（Work Breakdown Structure）ファイルの構造と記法を定義します。この仕様書に従うことで、WBSファイルを一貫性のある形式で作成し、ツールによる解析や変換を容易にすることが可能になります。

### 1.2. `simple-md-wbs` 記法の概要と特徴

`simple-md-wbs` 記法は、Markdownをベースとした軽量なWBS記述記法です。

* テキスト形式のため、バージョン管理システムとの連携が容易です。
* 可読性が高く、特別な`エディタ`を必要としません。
* 特定のツールに依存せず、汎用的に利用できます。

## 2. 基本思想：常に「見た目」を信じる

本プロジェクトには、過去の失敗から生まれた、とても重要な**絶対のルール**があります。

> **WBSの階層構造（親子関係）を判断するとき、常に「見た目」を正義とし、信頼する。**

### 2.1. 「見た目」ルールとは？（人間にとっての正義）

CSVファイルやExcelで、**タスク名が「大分類」「中分類」「小分類」のどの列に書かれているか**、ということです。これは人間が直感的に理解するための、最も信頼できる情報です。

### 2.2. 「番号」ルールとは？（システムの補助道具）

`01.01.01.00` のようなドット区切りの番号も階層を示しますが、これはあくまで**補助的な道具**です。入力ミスなどで「見た目」と「番号」が食い違う可能性があるため、**ツールは階層を判断する根拠として「番号」を決して信用してはなりません。**

ツールの責任は、常に「見た目」を基準とし、それに合致する正しい「番号」を自動で生成・修正することです。

## 3. ID体系：「名前」と「階層番号」

本ツールは、2種類のIDを明確に区別して扱います。

* **① ユーザー定義ID（タスクの「名前」）**
  * **役割**: タスク間の依存関係（`先行`・`後続`）を定義するために使います。人間が管理しやすいよう、`DA01` や `TSK_UI_001` のような自由な名前をつけます。
  * **注意**: このIDは、**階層（親子関係）とはまったく関係ありません**。
  * **記法**:
    * MD: `%%`行や`&lt;!-- --&gt;`コメントの先頭で指定します。
    * CSV: `タスクID` 列、 `関連番号` 列

* **② 階層ID（WBSの「住所番号」）**
  * **役割**: WBSツリー構造における物理的な位置を示します。`01.01.01.00` のような形式です。
  * **注意**: これは「見た目」ルールにしたがってツールが自動計算する**結果**であり、階層を決定する**原因**ではありません。
  * **記法**:
    * CSV: `番号` 列

## 4. 属性の記述方法

### 4.1. 階層表現と属性記法

WBSの階層構造は、Markdownの見出しとリストを用いて表現します。

* `#`（H1）: プロジェクト全体。階層レベル1。
* `##`（H2）: 大分類。階層レベル2。
* `###`（H3）: 中分類。階層レベル3。
* `####`（H4）: 小分類。階層レベル4。
* `-`（ハイフン）: タスクアイテム。

各項目の属性は、以下のルールで記述します。

* **カテゴリ (H1〜H4)**: 見出し行の直後にある `%%` で始まる行に、13個の属性をカンマ区切りで記述します。
* **タスク (-)**: リストアイテム行の直後にあるHTMLコメント `&lt;!-- ... --&gt;` 内に、13個の属性をカンマ区切りで記述します。

#### ファイルエンコーディング

`simple-md-wbs` ファイルは、**UTF-8** エンコーディングで保存してください。**UTF-8 with BOM** を推奨します。

#### 見出しのルール

* **必須:** 各見出し行（H1, H2, H3, H4）の**直後には、必ず1行の空行を挿入してください。**
* **推奨:** 各見出し行の前にも空行を挿入することを強く推奨します。

### 4.2. 属性フィールド一覧と詳細（カテゴリ・タスク共通）

> **重要:** 属性を記述する際は、**必ず13個のフィールドをカンマで区切って表現してください（カンマは12個必要です）。**後方の属性を省略する場合でも、その分のカンマ（例: `ID01,,,,,,,,,,,,コメント`）が必要です。フィールド数が仕様と異なる場合、属性が意図しない列に割り当てられる可能性があり、ツールから警告が出力されます。

以下の表は、属性行（`%%`）およびHTMLコメント属性内で使用される属性フィールドの定義と順序を示します。カテゴリ属性とタスク属性は、同じフィールドセットと順序を共有します。

| No. | インデックス | フィールド名       | 型（ツール内部）| 必須/任意 | 説明（Excel連携先や入力形式を明記）| 例 |
|-----|----------|--------------------|-----------------|-----------|----------------------------------------------------------------------------------------|----|
| 1   | 0        | **ユーザー記述ID** | String          | 必須      | アイテムを識別する**論理的な「名前」**。依存関係指定に使用。ファイル内での一意性を強く推奨。 | `D1`, `TSK001` |
| 2   | 1        | 開始日（入力）     | String          | 任意      | ExcelのS列「開始入力」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-06-01` |
| 3   | 2        | 終了日（入力）     | String          | 任意      | ExcelのT列「終了入力」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-07-31` |
| 4   | 3        | 日数（入力）       | String          | 任意      | ExcelのU列「日数入力」に対応。数値の文字列。                                           | `5`, `20` |
| 5   | 4        | 関連タスク種別     | String          | 任意      | `先行` または `後続`。CSVのF列「関連種別」に対応。                                     | `先行` |
| 6   | 5        | 関連タスクID       | String          | 任意      | 依存するタスクの「ユーザー記述ID」。CSVのG列「関連番号」の元データ。現状単一指定のみ。 | `TSK001`, `D1` |
| 7   | 6        | 開始日（実績）     | String          | 任意      | ExcelのZ列「開始実績」に対応。YYYY-MM-DD形式の文字列。                                 | `2025-06-05` |
| 8   | 7        | **終了日（実績）** | **String**      | **任意**  | **ExcelのAA列「修了実績」に対応。YYYY-MM-DD形式の文字列。タスク完了日。**              | **`2025-08-15`** |
| 9   | 8        | 進捗率             | String          | 任意      | ExcelのY列「進捗実績」に対応。パーセント表記（例: `50%`）のみ許容。                    | `50%` |
| 10  | 9        | 担当者             | String          | 任意      | ExcelのP列「担当者名」に対応。                                                         | `PM田中`, `佐藤リーダー` |
| 11  | 10       | 担当組織           | String          | 任意      | ExcelのO列「担当組織」に対応。                                                         | `全体統括`, `要件定義チーム` |
| 12  | 11       | 最終更新日         | String          | 任意      | ExcelのR列「最終更新」に対応。ユーザーによる手入力情報。YYYY-MM-DD形式の文字列。       | `2025-06-10` |
| 13 | 12 | コメント | String | 任意 | ExcelのJ列「コメント」（アクションプラン）に対応。このフィールド以降の文字列すべて。カンマ（`,`）を含むことも可能。 | `これは重要なタスクです, 詳細別途` |

**よくある間違いの例:**

* **カンマ不足:** `ID01,2025-01-01,,,,コメント`（6フィールドしかない。後方のフィールドが前にズレる）
* **カンマ過剰:** `ID01,,,,,,,,,,,,,,コメント`（14フィールドある。最後のカンマ以降がコメントとして扱われるが、意図しない場合がある）

## 5. 無視される行

以下の行は、ツールによって無視されます。

* 空行
* コメント行（`<!-- コメント -->`）
* 属性行で始まらない行（`%%` で始まらない行）
* リストアイテムで始まらない行（`-` または `*` で始まらない行）
* 見出しで始まらない行（`#` で始まらない行）

ユーザーは、WBSデータのブロック間に、これらの行を個人的なメモ、区切り線（`---` など）、または整形のための空行として自由に挿入できます。

## 6. 記述サンプル

以下は、`simple-md-wbs` 記法で記述されたWBSのサンプルです。**このサンプルは最新の13属性の定義と順序にしたがっています。**

```markdown
# プロジェクトAlpha <!-- 2.2. プロジェクト名（H1見出し）-->

<!-- 2.3. 見出し後の必須の空行 -->

## DA_設計フェーズ <!-- 2.2. 大分類（H2見出し）-->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01,2025-07-01,2025-08-31,40,,,2025-07-05,,設計リード,設計チーム,2025-07-03,基本設計と詳細設計を含む <!-- 4.1. カテゴリ属性行（13属性）-->
<!-- 属性順: UID,SD(in),ED(in),Dur(in),DepType,DepID,SD(act),ED(act),Progress,Assignee,Org,LastUpdate,Comment -->

<!-- 2.3. 見出し後の必須の空行 -->
### DA01CA_基本設計 <!-- 4.1. 中分類（H3見出し）-->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01,2025-07-01,2025-07-31,20,,,,,,設計担当A,設計チーム,2025-07-02,主要機能の骨格設計

<!-- 2.3. 見出し後の必須の空行 -->
#### DA01CA01SA_UI設計 <!-- 2.2. 小分類（H4見出し）-->

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01SA01,2025-07-01,2025-07-15,10,,,,,,,,UI/UXチーム,2025-07-01,画面遷移とコンポーネント定義

- UIモックアップ作成 <!-- 4.1. タスク属性（HTMLコメント内, 13属性）--> <!-- TSK_UI_001,2025-07-01,2025-07-08,5,,,2025-07-02,,0%,デザイナーA,UI/UXチーム,2025-07-02,Figmaで作成 -->
- UIレビューとフィードバック <!-- TSK_UI_002,2025-07-09,2025-07-15,3,先行,TSK_UI_001,2025-07-09,,0%,設計リード,設計チーム,2025-07-09,関係者レビュー -->

<!-- 2.3. 見出し後の必須の空行 -->
#### DA01CA01SB_DB設計

<!-- 2.3. 見出し後の必須の空行 -->
%% DA01CA01SB01,2025-07-16,2025-07-31,10,,,,,,,,DBA担当,設計チーム,2025-07-15,ER図とテーブル定義

- テーブル定義作成 <!-- TSK_DB_001,2025-07-16,2025-07-24,7,,,,0%,エンジニアB,DBA担当,2025-07-16,主要エンティティの洗い出し -->

--- <!-- 5. 無視される行の例 -->
設計フェーズはここまで。 <!-- 5. 無視される行の例 -->
---
```

## 7. 改訂履歴

| バージョン | 日付       | 変更者       | 変更内容 |
|------------|------------|--------------|----------|
| 1.1        | 2025-06-11 | AI Assistant | 開発者（AI含む）の誤解をなくすため、「『見た目』が正義」の原則とID体系を明確化する大規模改訂を実施。 |
| 1.0        | 2025-06-09 | IT Legacy    | MD to CSVが一段落した。例、サンプル記述の間違いでけっこう泣かされてしまった。また、Excelのファイル名を更新。 |
| 0.9        | 2025-06-04 | IT Legacy    | 日付・日数入力のサンプルをより実践的なパターンに修正。依存関係の記述例を明確化。関連する注釈を修正・追記。バージョン更新。 |
| 0.8        | 2025-06-04 | IT Legacy    | 日付・日数入力のサンプルコードを修正し、3つのうち2要素のみ入力するパターンを増やした。依存関係の例も日付を調整。注釈追加。バージョン更新。 |
| 0.7        | 2025-06-03 | IT Legacy    | カテゴリ・タスク属性の順序と内容を最終版の13属性に統一。書式例、具体例、記述サンプルをすべて最新仕様に更新。フィールドNo.3の修正。バージョン更新。 |
| 0.6        | 2025-06-03 | IT Legacy    | 「終了日（実績）」を属性に追加し全13属性に。Excel列名との対応を意識した説明に更新。進捗率形式、コメント位置FIX。サンプルを修正。バージョン更新。 |
| 0.4        | 2025-06-03 | IT Legacy    | 「進捗率」の入力形式をパーセント表記のみに限定。「状態」属性をリストから削除。属性順序を最終化。 |
| 0.3        | 2025-06-03 | IT Legacy    | 進捗率の入力形式をパーセント表記のみに限定。 |
